!function(a,b){"object"==typeof exports?module.exports=b(require("underscore"),require("backgrid")):"function"==typeof define&&define.amd?define(["underscore","backgrid"],b):b(a._,a.Backgrid)}(this,function(a,b){"use strict";return b.Extension.SizeAbleColumns=Backbone.View.extend({tagName:"colgroup",initialize:function(a){this.grid=a.grid,this.listenTo(this.grid.header,"backgrid:header:rendered",this.render),this.listenTo(this.grid.columns,"width:auto",this.setWidthAuto),this.listenTo(this.grid.columns,"width:fixed",this.setWidthFixed),this.listenTo(this.grid,"backgrid:refresh",this.setColToActualWidth),this.listenTo(this.grid.collection,"add remove reset",this.setColToActualWidth)},render:function(){var b=this;return b.$el.empty(),b.grid.columns.each(function(a){if("undefined"==typeof a.get("renderable")||a.get("renderable")){var c=$("<col>").appendTo(b.$el).attr("data-column-cid",a.cid),d=a.get("width"),e=a.get("minWidth"),f=a.get("maxWidth");d&&"*"!=d&&(e&&d<e&&(d=e),f&&d>f&&(d=f),c.width(d))}}),b.grid.header.headerRows?a.each(b.grid.header.headerRows,function(b){a.each(b.cells,function(a){a.$el.attr("data-column-cid",a.column.cid)})}):a.each(b.grid.header.row.cells,function(a){a.$el.attr("data-column-cid",a.column.cid)}),b.grid.collection.trigger("backgrid:colgroup:changed"),this},getColumnElement:function(a){return this.$el.find('col[data-column-cid="'+a.cid+'"]')},getHeaderElementWidth:function(a){return this.grid.header.$el.find("th[data-column-cid='"+a.cid+"']").outerWidth()},setWidthAuto:function(a){var b=this.getColumnElement(a);a.set("width","*"),b.css("width",""),view.grid.collection.trigger("backgrid:colgroup:updated")},setWidthFixed:function(a){var b=this.getColumnElement(a),c=this.getHeaderElementWidth(a);b.css("width",c),a.set("width",c),view.grid.collection.trigger("backgrid:colgroup:updated")},setColToActualWidth:function(){var b=this,c=!1;a.each(b.grid.header.row.cells,function(a){var d=b.getColumnElement(a.column);"*"!==a.column.get("width")&&(c=c||d.width()==a.$el.outerWidth(),d.width(a.$el.outerWidth()))}),c&&b.grid.collection.trigger("backgrid:colgroup:updated")}}),b.Extension.SizeAbleColumnsHandlers=Backbone.View.extend({initialize:function(a){this.sizeAbleColumns=a.sizeAbleColumns,this.grid=this.sizeAbleColumns.grid,this.columns=this.grid.columns,this.header=this.grid.header,this.saveColumnWidth=a.saveColumnWidth,this.setHeaderElements(),this.attachEvents()},render:function(){var b=this;return b.$el.empty(),a.each(b.headerElements,function(a,c){var d=$(a),e=d.data("column-cid"),f=b.sizeAbleColumns.$el.find("col[data-column-cid="+e+"]"),g=b.columns.get({cid:e});if(g&&g.get("resizeable")){var h=$("<div></div>").addClass("resizeHandler").attr("data-column-index",c).appendTo(b.$el),i=$("<div></div>").hide().addClass("grid-draggable-cursor").appendTo(h);h.on("mousedown",function(a){b._stopEvent(a);var c=Math.round(h.offset().left),e=$(document),j=h.outerWidth();h.addClass("grid-draggable"),i.show();var k=function(a){b._stopEvent(a);var d=g.get("minWidth");(!d||d<20)&&(d=20);var e=g.get("maxWidth"),f=a.pageX,i=g.get("width"),k=i+(f-c)-j/2;d&&k<=d&&(f=c-(i-d)+j/2),e&&k>=e&&(f=c+e-i+j/2),h.offset({left:f})};e.on("mousemove",k);var l=function(a){b._stopEvent(a),h.removeClass("grid-draggable"),i.hide(),e.off("mouseup",l),e.off("mousemove",k);var j=Math.round(h.offset().left),m=c-j,n=d.outerWidth(),o=n-m;f.width(o);var p=d.outerWidth();if(f.width(p),p!=n){b.saveColumnWidth&&g.set("width",p,{silent:!0}),g.trigger("resize",g,p,n);var q=b.columns.findWhere({width:"*"});q&&q.trigger("resize",q)}b.updateHandlerPosition()};e.on("mouseup",l)})}}),b.updateHandlerPosition(),this},_stopEvent:function(a){a.stopPropagation&&a.stopPropagation(),a.preventDefault&&a.preventDefault(),a.cancelBubble=!0,a.returnValue=!1},attachEvents:function(){var b=this;b.listenTo(b.columns,"change:resizeable",b.render),b.listenTo(b.columns,"resize width:auto width:fixed add remove",b.checkSpacerColumn),b.listenTo(b.grid.collection,"backgrid:colgroup:updated",b.updateHandlerPosition),b.listenTo(b.grid.collection,"backgrid:colgroup:changed",function(){a.defer(function(){b.setHeaderElements(),b.render()})}),this.resizeEvtHandler=a.debounce(a.bind(b.updateHandlerPosition,b),250),$(window).on("resize",this.resizeEvtHandler)},checkSpacerColumn:function(){var b=this,c=a.first(b.columns.where({name:"__spacerColumn"})),d=b.columns.filter(function(a){return"*"==a.get("width")&&"__spacerColumn"!=a.get("name")});if(a.isEmpty(d)){var e=b.columns.reduce(function(a,b){var c="*"==b.get("width")?0:b.get("width");return a+c},0),f=b.grid.$el.width();f>e?c||b.columns.add(b.getSpacerColumn()):c&&b.columns.remove(c)}else c&&b.columns.remove(c)},getSpacerColumn:function(){return b.Extension.SizeAbleColumns.spacerColumnDefinition},updateHandlerPosition:function(){var b=this;a.each(b.headerElements,function(a,c){var d=$(a);b.$el.children().filter("[data-column-index='"+c+"']").css("left",d.position().left+d.outerWidth())})},setHeaderElements:function(){var b=this,c=b.grid.header.headerRows||[b.grid.header.row];b.headerCells=[],a.each(c,function(c){a.each(c.cells,function(c){var d=b.columns.get({cid:c.column.cid});a.isEmpty(d)||b.headerCells.push({$el:c.$el,el:c.el,column:d})})});var d=a.sortBy(b.headerCells,function(a){return b.columns.indexOf(a.column)});b.headerCells=a.filter(d,function(a){return a.column.get("renderable")===!0||"undefined"==typeof a.column.get("renderable")}),b.headerElements=a.map(b.headerCells,function(a){return a.el})},remove:function(){$(window).off("resize",this.resizeEvtHandler),Backbone.View.prototype.remove.call(this)}}),b.Extension.SizeAbleColumns.spacerColumnDefinition={name:"__spacerColumn",label:"",editable:!1,cell:b.StringCell,width:"*",nesting:[],resizeable:!1,sortable:!1,orderable:!1,displayOrder:9999},b});