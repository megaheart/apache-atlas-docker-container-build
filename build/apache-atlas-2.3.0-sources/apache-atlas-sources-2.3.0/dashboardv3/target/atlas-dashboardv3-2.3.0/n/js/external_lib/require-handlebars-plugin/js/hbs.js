define(["handlebars","underscore","i18nprecompile"],function(a,b,c){var d,e,f=["Msxml2.XMLHTTP","Microsoft.XMLHTTP","Msxml2.XMLHTTP.4.0"],g=function(){throw new Error("Environment unsupported.")},h=[],i="w+",j="hbs",k="@hbs",l="/styles/",m="/demo-build/styles/",n="template/helpers/",o="template/i18n/",p="screen.build.css";a.registerHelper("$",function(){}),"undefined"!=typeof window&&window.navigator&&window.document&&!window.navigator.userAgent.match(/Node.js/)?(e=function(){var a,b,c;if("undefined"!=typeof XMLHttpRequest)return new XMLHttpRequest;for(b=0;b<3;b++){c=f[b];try{a=new ActiveXObject(c)}catch(a){}if(a){f=[c];break}}if(!a)throw new Error("getXhr(): XMLHttpRequest not available");return a},g=function(a,b){var c=e();c.open("GET",a,!0),c.onreadystatechange=function(a){4===c.readyState&&b(c.responseText)},c.send(null)}):"undefined"!=typeof process&&process.versions&&process.versions.node?(d=require.nodeRequire("fs"),g=function(a,b){var c=d.readFileSync(a,"utf8")||"";c=c.replace(/^\uFEFF/,""),b(c)}):"undefined"!=typeof java&&"undefined"!=typeof java.io&&(g=function(a,b){for(var c,d=new java.io.File(a),e=new java.io.FileReader(d),f=new java.io.BufferedReader(e),g="";null!==(c=f.readLine());)g+=new String(c)+"\n";f.close(),b(g)});var q={},r=function(a,b){q[a]?b(q[a]):g(a,function(c){q[a]=c,b.call(this,c)})},s=[],t={};return{get:function(){return a},write:function(a,b,c){if(b+k in h){var d=h[b+k];c.asModule(a+"!"+b,d)}},version:"0.4.0",load:function(e,f,q,u){function v(a,c){return b(a).forEach(function(a){a&&a.type&&"partial"===a.type&&c.push(a.partialName.name),a&&a.program&&a.program.statements&&v(a.program.statements,c),a&&a.program&&a.program.inverse&&a.program.inverse.statements&&v(a.program.inverse.statements,c)}),c}function w(a){var c=[];return a&&a.statements&&(c=v(a.statements,[])),b(c).unique()}function x(a){var b,c,d;if(a&&a.statements&&(b=a.statements[0],b&&"comment"===b.type))try{return c=b.comment.replace(new RegExp("^[\\s]+|[\\s]+$","g"),""),d=JSON.parse(c),c}catch(a){return"{}"}return"{}"}function y(a){if(!a)return[];var b,c=[a[0]],d=a[0];for(b=1;b<a.length;++b)a.hasOwnProperty(b)&&(d+="."+a[b],c.push(d));return c}function z(c,d,e,f){e=e?e+".":"";var g="";return b(c).forEach(function(c){var h,i,j;if(c&&c.type&&"mustache"===c.type){if(!c.params||!c.params.length){h=y(c.id.parts);for(i in h)h[i]&&(g=h[i]||g,d.push(e+h[i]));d.push(e+c.id.string)}var k=["this",".","..","./..","../..","../../.."];c.params&&"undefined"==typeof a.helpers[c.id.string]&&b(c.params).forEach(function(i){(b(k).contains(i.original)||i instanceof a.AST.StringNode||i instanceof a.AST.IntegerNode||i instanceof a.AST.BooleanNode)&&f.push(c.id.string),h=y(i.parts);for(var j in h)h[j]&&(g=h[j]||g,f.push(c.id.string),d.push(e+h[j]))})}c&&c.mustache&&z([c.mustache],d,e+g,f),c&&c.program&&c.program.statements&&(j=z([c.mustache],[],"",f)[0]||"",c.program.inverse&&c.program.inverse.statements&&z(c.program.inverse.statements,d,e+g+(j?e+g?"."+j:j:""),f),z(c.program.statements,d,e+g+(j?e+g?"."+j:j:""),f))}),d}function A(a){var c=[],d=[];a&&a.statements&&(c=z(a.statements,[],void 0,d));var e=["helperMissing","blockHelperMissing","each","if","unless","with"];return{vars:b(c).chain().unique().map(function(a){return""===a?".":a.length&&"."===a[a.length-1]?a.substr(0,a.length-1)+"[]":a}).value(),helpers:b(d).chain().unique().map(function(a){if(!b(e).contains(a))return a}).compact().value()}}function B(j){g(C,function(g){var k,o,r,v=a.parse(g),y=w(v),z=x(v),B=A(v),F=B.vars,G=B.helpers||[],H=y.join("', 'hbs!").replace(/_/g,"/"),I=u.hbs&&u.hbs.disableHelpers?"":function(){var a,b=[],c=u.hbs&&u.hbs.helperPathCallback?u.hbs.helperPathCallback:function(a){return(u.hbs&&u.hbs.helperDirectory?u.hbs.helperDirectory:n)+a};for(a=0;a<G.length;a++)b[a]="'"+c(G[a],C)+"'";return b}().join(","),J="",K="",L="";if(H&&(H=",'hbs!"+H+"'"),I&&(I=","+I),"{}"!==z)try{k=JSON.parse(z),k&&k.styles&&(s=b.union(s,k.styles),require.isBrowser&&!u.isBuild?(o=document.head||document.getElementsByTagName("head")[0],b(k.styles).forEach(function(a){t[a]||(r=document.createElement("link"),r.href=u.baseUrl+l+a+".css",r.media="all",r.rel="stylesheet",r.type="text/css",o.appendChild(r),t[a]=r)})):u.isBuild&&!function(){var a=require.nodeRequire("fs"),c=b(k.styles).map(function(a){return t[a]?"":(t[a]=!0,"@import url("+a+".css);\n")}).join("\n");a.open(__dirname+m+p,i,"0666",function(b,d){a.writeSync(d,c,null,encoding="utf8"),a.close(d)}),i="a"}())}catch(a){console.log("error injecting styles")}u.isBuild||u.serverRender||(J="<!-- START - "+e+" -->",K="<!-- END - "+e+" -->",L="t.meta = "+z+";\nt.helpers = "+JSON.stringify(G)+";\nt.deps = "+JSON.stringify(y)+";\nt.vars = "+JSON.stringify(F)+";\n");var M=!E&&b.extend(j,u.localeMapping),N=u.hbs||{},O=b.extend(N.compileOptions||{},{originalKeyFallback:N.originalKeyFallback}),P=c(g,M,O);g="/* START_TEMPLATE */\ndefine(['hbs','handlebars'"+H+I+"], function( hbs, Handlebars ){ \nvar t = Handlebars.template("+P+");\nHandlebars.registerPartial('"+e.replace(/\//g,"_")+"', t);\n"+L+"return t;\n});\n/* END_TEMPLATE */\n",u.isBuild&&(h[D]=g),u.isBuild||(g+="\r\n//@ sourceURL="+C);for(var Q in y)y.hasOwnProperty(Q)&&(y[Q]="hbs!"+y[Q].replace(/_/g,"/"));u.isBuild?(q.fromText(e,g),f([e],function(a){q(a)})):require(y,function(){q.fromText(g),f([e],function(a){q(a)})}),u.removeCombined&&d.unlinkSync(C)})}var C,D=e+k,E=u.hbs&&u.hbs.disableI18n,F=u.hbs&&u.hbs.templateExtension===!1;if(C=F?f.toUrl(e):f.toUrl(e+"."+(u.hbs&&u.hbs.templateExtension?u.hbs.templateExtension:j)),E)B(!1);else{var G=(u.hbs&&u.hbs.i18nDirectory?u.hbs.i18nDirectory:o)+(u.locale||"en_us")+".json";try{r(f.toUrl(G),function(a){B(JSON.parse(a))})}catch(a){if(u.hbs)throw a;console.warn("hbs: Error reading "+G+", disabling i18n. Ignore this if you're using jam, otherwise check your i18n configuration.\n"),u.hbs={disableI18n:!0},B(!1)}}}}});