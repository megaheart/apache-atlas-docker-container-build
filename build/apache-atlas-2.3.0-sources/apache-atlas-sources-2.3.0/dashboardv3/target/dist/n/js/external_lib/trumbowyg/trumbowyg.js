jQuery.trumbowyg={langs:{en:{viewHTML:"Plain Text",undo:"Undo",redo:"Redo",formatting:"Formatting",p:"Paragraph",blockquote:"Quote",code:"Code",header:"Header",bold:"Bold",italic:"Italic",strikethrough:"Strikethrough",underline:"Underline",strong:"Strong",em:"Emphasis",del:"Deleted",superscript:"Superscript",subscript:"Subscript",unorderedList:"Unordered list",orderedList:"Ordered list",insertImage:"Insert Image",link:"Link",createLink:"Insert link",unlink:"Remove link",justifyLeft:"Align Left",justifyCenter:"Align Center",justifyRight:"Align Right",justifyFull:"Align Justify",horizontalRule:"Insert horizontal rule",removeformat:"Remove format",fullscreen:"Fullscreen",close:"Close",submit:"Confirm",reset:"Cancel",required:"Required",description:"Description",title:"Title",text:"Text",target:"Target",width:"Width"}},plugins:{},svgPath:null,svgAbsoluteUseHref:!1,hideButtonTexts:null},Object.defineProperty(jQuery.trumbowyg,"defaultOptions",{value:{lang:"en",fixedBtnPane:!1,fixedFullWidth:!1,autogrow:!1,autogrowOnEnter:!1,imageWidthModalEdit:!1,hideButtonTexts:null,prefix:"trumbowyg-",tagClasses:{},semantic:!0,semanticKeepAttributes:!1,resetCss:!1,removeformatPasted:!1,tabToIndent:!1,tagsToRemove:[],tagsToKeep:["hr","img","embed","iframe","input"],btns:[["viewHTML"],["undo","redo"],["formatting"],["strong","em","del"],["superscript","subscript"],["link"],["insertImage"],["justifyLeft","justifyCenter","justifyRight","justifyFull"],["unorderedList","orderedList"],["horizontalRule"],["removeformat"],["fullscreen"]],btnsDef:{},changeActiveDropdownIcon:!1,inlineElementsSelector:"a,abbr,acronym,b,caption,cite,code,col,dfn,dir,dt,dd,em,font,hr,i,kbd,li,q,span,strikeout,strong,sub,sup,u",pasteHandlers:[],plugins:{},urlProtocol:!1,minimalLinks:!1,defaultLinkTarget:void 0,svgPath:null},writable:!1,enumerable:!0,configurable:!1}),function(a,b,c,d){"use strict";var e="tbwconfirm",f="tbwcancel";d.fn.trumbowyg=function(a,b){var c="trumbowyg";if(a===Object(a)||!a)return this.each(function(){d(this).data(c)||d(this).data(c,new g(this,a))});if(1===this.length)try{var e=d(this).data(c);switch(a){case"execCmd":return e.execCmd(b.cmd,b.param,b.forceCss,b.skipTrumbowyg);case"openModal":return e.openModal(b.title,b.content);case"closeModal":return e.closeModal();case"openModalInsert":return e.openModalInsert(b.title,b.fields,b.callback);case"saveRange":return e.saveRange();case"getRange":return e.range;case"getRangeText":return e.getRangeText();case"restoreRange":return e.restoreRange();case"enable":return e.setDisabled(!1);case"disable":return e.setDisabled(!0);case"toggle":return e.toggle();case"destroy":return e.destroy();case"empty":return e.empty();case"html":return e.html(b)}}catch(a){}return!1};var g=function(e,f){var g=this,h="trumbowyg-icons",i=d.trumbowyg;g.doc=e.ownerDocument||c,g.$ta=d(e),g.$c=d(e),null!=(f=f||{}).lang||null!=i.langs[f.lang]?g.lang=d.extend(!0,{},i.langs.en,i.langs[f.lang]):g.lang=i.langs.en,g.hideButtonTexts=(null!=i.hideButtonTexts?i:f).hideButtonTexts;var j,k=(null!=i.svgPath?i:f).svgPath;g.hasSvg=!1!==k,!1===k||!i.svgAbsoluteUseHref&&0!==d("#"+h,g.doc).length||(null==k&&d("script[src]").each(function(a,b){var c=b.src,b=c.match("trumbowyg(.min)?.js");null!=b&&(k=c.substring(0,c.indexOf(b[0]))+"ui/icons.svg")}),null==k?console.warn("You must define svgPath: https://goo.gl/CfTY9U"):i.svgAbsoluteUseHref||((j=g.doc.createElement("div")).id=h,g.doc.body.insertBefore(j,g.doc.body.childNodes[0]),d.ajax({async:!0,type:"GET",contentType:"application/x-www-form-urlencoded; charset=UTF-8",dataType:"xml",crossDomain:!0,url:k,data:null,beforeSend:null,complete:null,success:function(a){j.innerHTML=(new XMLSerializer).serializeToString(a.documentElement)}})));var l=g.doc.querySelector("base")?b.location.href.split(/[?#]/)[0]:"";g.svgPath=i.svgAbsoluteUseHref?k:l,h=g.lang.header,l=function(){return(b.chrome||b.Intl&&Intl.v8BreakIterator)&&"CSS"in b},g.btnsDef={viewHTML:{fn:"toggle",class:"trumbowyg-not-disable",name1:"name1"},undo:{isSupported:l,key:"Z"},redo:{isSupported:l,key:"Y"},p:{fn:"formatBlock"},blockquote:{fn:"formatBlock"},h1:{fn:"formatBlock",title:h+" 1"},h2:{fn:"formatBlock",title:h+" 2"},h3:{fn:"formatBlock",title:h+" 3"},h4:{fn:"formatBlock",title:h+" 4"},h5:{fn:"formatBlock",title:h+" 5"},h6:{fn:"formatBlock",title:h+" 6"},subscript:{tag:"sub"},superscript:{tag:"sup"},bold:{key:"B",tag:"b"},italic:{key:"I",tag:"i"},underline:{tag:"u"},strikethrough:{tag:"strike"},strong:{fn:"bold",key:"B"},em:{fn:"italic",key:"I"},del:{fn:"strikethrough"},createLink:{key:"K",tag:"a"},unlink:{},insertImage:{},justifyLeft:{tag:"left",forceCss:!0},justifyCenter:{tag:"center",forceCss:!0},justifyRight:{tag:"right",forceCss:!0},justifyFull:{tag:"justify",forceCss:!0},unorderedList:{fn:"insertUnorderedList",tag:"ul"},orderedList:{fn:"insertOrderedList",tag:"ol"},horizontalRule:{fn:"insertHorizontalRule"},removeformat:{},fullscreen:{class:"trumbowyg-not-disable"},close:{fn:"destroy",class:"trumbowyg-not-disable"},formatting:{dropdown:["p","h1","h2","h3","h4"],ico:"p"},link:{dropdown:["createLink","unlink"]}},g.o=d.extend(!0,{},i.defaultOptions,f),g.o.hasOwnProperty("imgDblClickHandler")||(g.o.imgDblClickHandler=g.getDefaultImgDblClickHandler()),g.urlPrefix=g.setupUrlPrefix(),g.disabled=g.o.disabled||"TEXTAREA"===e.nodeName&&e.disabled,f.btns?g.o.btns=f.btns:g.o.semantic||(g.o.btns[3]=["bold","italic","underline","strikethrough"]),d.each(g.o.btnsDef,function(a,b){g.addBtnDef(a,b)}),g.eventNamespace="trumbowyg-event",g.keys=[],g.tagToButton={},g.tagHandlers=[],g.pasteHandlers=[].concat(g.o.pasteHandlers),g.isIE=-1!==a.userAgent.indexOf("MSIE")||-1!==a.appVersion.indexOf("Trident/"),g.isMac=-1!==a.platform.toUpperCase().indexOf("MAC"),g.init()};g.prototype={DEFAULT_SEMANTIC_MAP:{b:"strong",i:"em",s:"del",strike:"del",div:"p"},init:function(){var a=this;a.height=a.$ta.height(),a.initPlugins();try{a.doc.execCommand("enableObjectResizing",!1,!1),a.doc.execCommand("defaultParagraphSeparator",!1,"p")}catch(a){}a.buildEditor(),a.buildBtnPane(),a.fixedBtnPaneEvents(),a.buildOverlay(),setTimeout(function(){a.disabled&&a.setDisabled(!0),a.$c.trigger("tbwinit")})},addBtnDef:function(a,b){this.btnsDef[a]=d.extend(b,this.btnsDef[a]||{})},setupUrlPrefix:function(){var a=this.o.urlProtocol;if(a)return"string"!=typeof a?"https://":a.replace("://","")+"://"},buildEditor:function(){var a=this,c=a.o.prefix,e="";a.$box=d("<div/>",{class:c+"box "+c+"editor-visible "+c+a.o.lang+" trumbowyg"}),a.isTextarea=a.$ta.is("textarea"),a.isTextarea?(e=a.$ta.val(),a.$ed=d("<div/>"),a.$box.insertAfter(a.$ta).append(a.$ed,a.$ta)):(a.$ed=a.$ta,e=a.$ed.html(),a.$ta=d("<textarea/>",{name:a.$ta.attr("id"),height:a.height}).val(e),a.$box.insertAfter(a.$ed).append(a.$ta,a.$ed),a.syncCode()),a.$ta.addClass(c+"textarea").attr("tabindex",-1),a.$ed.addClass(c+"editor").attr({contenteditable:!0,dir:a.lang._dir||"ltr"}).html(e),a.o.tabindex&&a.$ed.attr("tabindex",a.o.tabindex),a.$c.is("[placeholder]")&&a.$ed.attr("placeholder",a.$c.attr("placeholder")),a.$c.is("[spellcheck]")&&a.$ed.attr("spellcheck",a.$c.attr("spellcheck")),a.o.resetCss&&a.$ed.addClass(c+"reset-css"),a.o.autogrow||a.$ta.add(a.$ed).css({height:a.height}),a.semanticCode(),a.o.autogrowOnEnter&&a.$ed.addClass(c+"autogrow-on-enter");var f,g=!1,h=!1;a.$ed.on("dblclick","img",a.o.imgDblClickHandler).on("keydown",function(b){var c=b.which;if(8!==c&&13!==c&&46!==c||a.toggleSpan(!0),!b.ctrlKey&&!b.metaKey||b.altKey){if(a.o.tabToIndent&&"Tab"===b.key)try{return b.shiftKey?a.execCmd("outdent",!0,null):a.execCmd("indent",!0,null),!1}catch(a){}}else{g=!0;var d=a.keys[String.fromCharCode(b.which).toUpperCase()];try{return a.execCmd(d.fn,d.param),!1}catch(a){}}}).on("compositionstart compositionupdate",function(){h=!0}).on("keyup compositionend",function(b){if("compositionend"===b.type)h=!1;else if(h)return;var c=b.which;37<=c&&c<=40||(8!==c&&13!==c&&46!==c||a.toggleSpan(),!b.ctrlKey&&!b.metaKey||89!==c&&90!==c?g||17===c?void 0===b.which&&a.semanticCode(!1,!1,!0):(b=!a.isIE||"compositionend"===b.type,a.semanticCode(!1,b&&13===c),a.$c.trigger("tbwchange")):(a.semanticCode(!1,!0),a.$c.trigger("tbwchange")),setTimeout(function(){g=!1},50))}).on("mouseup keydown keyup",function(b){(b.ctrlKey||b.metaKey)&&!b.altKey||setTimeout(function(){g=!1},50),clearTimeout(f),f=setTimeout(function(){a.updateButtonPaneStatus()},50)}).on("focus blur",function(b){"blur"===b.type&&a.clearButtonPaneStatus(),a.$c.trigger("tbw"+b.type),a.o.autogrowOnEnter&&(a.autogrowOnEnterDontClose||("focus"===b.type?(a.autogrowOnEnterWasFocused=!0,a.autogrowEditorOnEnter()):a.o.autogrow||(a.$ed.css({height:a.$ed.css("min-height")}),a.$c.trigger("tbwresize"))))}).on("keyup focus",function(){a.$ta.val().match(/<.*>/)||a.$ed.html().match(/<.*>/)||setTimeout(function(){var b=a.isIE?"<p>":"p";a.doc.execCommand("formatBlock",!1,b),a.syncCode()},0)}).on("cut drop",function(){setTimeout(function(){a.semanticCode(!1,!0),a.$c.trigger("tbwchange")},0)}).on("paste",function(c){if(a.o.removeformatPasted){c.preventDefault(),b.getSelection&&b.getSelection().deleteFromDocument&&b.getSelection().deleteFromDocument();try{var e=b.clipboardData.getData("Text");try{a.doc.selection.createRange().pasteHTML(e)}catch(b){a.doc.getSelection().getRangeAt(0).insertNode(a.doc.createTextNode(e))}a.$c.trigger("tbwchange",c)}catch(b){a.execCmd("insertText",(c.originalEvent||c).clipboardData.getData("text/plain"))}}d.each(a.pasteHandlers,function(a,b){b(c)}),setTimeout(function(){a.semanticCode(!1,!0),a.$c.trigger("tbwpaste",c),a.$c.trigger("tbwchange")},0)}),a.$ta.on("keyup",function(){a.$c.trigger("tbwchange")}).on("paste",function(){setTimeout(function(){a.$c.trigger("tbwchange")},0)}),d(a.doc.body).on("keydown."+a.eventNamespace,function(b){if(27===b.which&&1<=d("."+c+"modal-box").length)return a.closeModal(),!1})},autogrowEditorOnEnter:function(){var a=this;a.$ed.removeClass("autogrow-on-enter");var b=a.$ed[0].clientHeight;a.$ed.height("auto");var c=a.$ed[0].scrollHeight;a.$ed.addClass("autogrow-on-enter"),b!==c&&(a.$ed.height(b),setTimeout(function(){a.$ed.css({height:c}),a.$c.trigger("tbwresize")},0))},buildBtnPane:function(){var a=this,b=a.o.prefix,c=a.$btnPane=d("<div/>",{class:b+"button-pane"});d.each(a.o.btns,function(e,f){d.isArray(f)||(f=[f]);var g=d("<div/>",{class:b+"button-group "+(0<=f.indexOf("fullscreen")?b+"right":"")});d.each(f,function(b,c){try{a.isSupportedBtn(c)&&g.append(a.buildBtn(c))}catch(a){}}),0<g.html().trim().length&&c.append(g)}),a.$box.prepend(c)},buildBtn:function(a){var b,c=this,e=c.o.prefix,f=c.btnsDef[a],g=f.dropdown,h=null==f.hasIcon||f.hasIcon,i=c.lang[a]||a,j=d("<button/>",{type:"button",class:e+a+"-button "+(f.class||"")+(h?"":" "+e+"textual-button"),html:!f.name1&&c.hasSvg&&h?'<svg><use xlink:href="'+c.svgPath+"#"+e+(f.ico||a).replace(/([A-Z]+)/g,"-$1").toLowerCase()+'"/></svg>':c.hideButtonTexts?"":f.text||f.title||c.lang[a]||a,title:(f.title||f.text||i)+(f.key?" ("+(c.isMac?"Cmd":"Ctrl")+" + "+f.key+")":""),tabindex:-1,mousedown:function(){return g&&!d("."+a+"-"+e+"dropdown",c.$box).is(":hidden")||d("body",c.doc).trigger("mousedown"),(!c.$btnPane.hasClass(e+"disable")&&!c.$box.hasClass(e+"disabled")||d(this).hasClass(e+"active")||d(this).hasClass(e+"not-disable"))&&c.execCmd((g?"dropdown":f.fn)||a,f.param||a,f.forceCss),!1}});return g?(j.addClass(e+"open-dropdown"),(i={class:(h=e+"dropdown")+"-"+a+" "+h+" "+e+"fixed-top "+(f.dropdownClass||"")})["data-"+h]=a,b=d("<div/>",i),d.each(g,function(a,d){c.btnsDef[d]&&c.isSupportedBtn(d)&&b.append(c.buildSubBtn(d))}),c.$box.append(b.hide())):f.key&&(c.keys[f.key]={fn:f.fn||a,param:f.param||a}),g||(c.tagToButton[(f.tag||a).toLowerCase()]=a),j},buildSubBtn:function(a){var b=this,c=b.o.prefix,e=b.btnsDef[a],f=null==e.hasIcon||e.hasIcon;return e.key&&(b.keys[e.key]={fn:e.fn||a,param:e.param||a}),b.tagToButton[(e.tag||a).toLowerCase()]=a,d("<button/>",{type:"button",class:c+a+"-dropdown-button "+(e.class||"")+(e.ico?" "+c+e.ico+"-button":""),html:b.hasSvg&&f?'<svg><use xlink:href="'+b.svgPath+"#"+c+(e.ico||a).replace(/([A-Z]+)/g,"-$1").toLowerCase()+'"/></svg>'+(e.text||e.title||b.lang[a]||a):e.text||e.title||b.lang[a]||a,title:e.key?"("+(b.isMac?"Cmd":"Ctrl")+" + "+e.key+")":null,style:e.style||null,mousedown:function(){return d("body",b.doc).trigger("mousedown"),b.execCmd(e.fn||a,e.param||a,e.forceCss),!1}})},isSupportedBtn:function(a){try{return this.btnsDef[a].isSupported()}catch(a){}return!0},buildOverlay:function(){return this.$overlay=d("<div/>",{class:this.o.prefix+"overlay"}).appendTo(this.$box),this.$overlay},showOverlay:function(){d(b).trigger("scroll"),this.$overlay.fadeIn(200),this.$box.addClass(this.o.prefix+"box-blur")},hideOverlay:function(){this.$overlay.fadeOut(50),this.$box.removeClass(this.o.prefix+"box-blur")},fixedBtnPaneEvents:function(){var a=this,c=a.o.fixedFullWidth,e=a.$box;a.o.fixedBtnPane&&(a.isFixed=!1,d(b).on("scroll."+a.eventNamespace+" resize."+a.eventNamespace,function(){var f,g,h,i;e&&(a.syncCode(),f=d(b).scrollTop(),g=e.offset().top+1,i=(h=a.$btnPane).outerHeight()-2,0<f-g&&f-g-a.height<0?(a.isFixed||(a.isFixed=!0,h.css({position:"fixed",top:0,left:c?0:"auto",zIndex:7}),a.$box.css({paddingTop:h.height()})),h.css({width:c?"100%":e.width()-1}),d("."+a.o.prefix+"fixed-top",e).css({position:c?"fixed":"absolute",top:c?i:f-g+i,zIndex:15})):a.isFixed&&(a.isFixed=!1,h.removeAttr("style"),a.$box.css({paddingTop:0}),d("."+a.o.prefix+"fixed-top",e).css({position:"absolute",top:i})))}))},setDisabled:function(a){var b=this,c=b.o.prefix;(b.disabled=a)?b.$ta.attr("disabled",!0):b.$ta.removeAttr("disabled"),b.$box.toggleClass(c+"disabled",a),b.$ed.attr("contenteditable",!a)},destroy:function(){var a=this,c=a.o.prefix;a.isTextarea?a.$box.after(a.$ta.css({height:""}).val(a.html()).removeClass(c+"textarea").show()):a.$box.after(a.$ed.css({height:""}).removeClass(c+"editor").removeAttr("contenteditable").removeAttr("dir").html(a.html()).show()),a.$ed.off("dblclick","img"),a.destroyPlugins(),a.$box.remove(),a.$c.removeData("trumbowyg"),d("body").removeClass(c+"body-fullscreen"),a.$c.trigger("tbwclose"),d(b).off("scroll."+a.eventNamespace+" resize."+a.eventNamespace),d(a.doc.body).off("keydown."+a.eventNamespace)},empty:function(){this.$ta.val(""),this.syncCode(!0)},toggle:function(){var a=this,b=a.o.prefix;a.o.autogrowOnEnter&&(a.autogrowOnEnterDontClose=!a.$box.hasClass(b+"editor-hidden")),a.semanticCode(!1,!0),a.$c.trigger("tbwchange"),setTimeout(function(){a.doc.activeElement.blur(),a.$box.toggleClass(b+"editor-hidden "+b+"editor-visible"),a.$btnPane.toggleClass(b+"disable"),a.$btnPane.find(".trumbowyg-viewHTML-button").text(a.$box.hasClass(b+"editor-hidden")?"Formatted Text":"Plain Text").attr("data-original-title",a.$box.hasClass(b+"editor-hidden")?"Formatted Text":"Plain Text"),d("."+b+"viewHTML-button",a.$btnPane).toggleClass(b+"active"),a.$box.hasClass(b+"editor-visible")?a.$ta.attr("tabindex",-1):a.$ta.removeAttr("tabindex"),a.o.autogrowOnEnter&&!a.autogrowOnEnterDontClose&&a.autogrowEditorOnEnter()},0)},toggleSpan:function(a){this.$ed.find("span").each(function(){!0===a?d(this).attr("data-tbw-flag",!0):d(this).attr("data-tbw-flag")?d(this).removeAttr("data-tbw-flag"):d(this).contents().unwrap()})},dropdown:function(a){var c=this,e=d("body",c.doc),f=c.o.prefix,g=d("[data-"+f+"dropdown="+a+"]",c.$box),h=d("."+f+a+"-button",c.$btnPane),a=g.is(":hidden");e.trigger("mousedown"),a&&(a=h.offset().left,h.addClass(f+"active"),g.css({position:"absolute",top:h.offset().top-c.$btnPane.offset().top+h.outerHeight(),left:c.o.fixedFullWidth&&c.isFixed?a:a-c.$btnPane.offset().left}).show(),d(b).trigger("scroll"),e.on("mousedown."+c.eventNamespace,function(a){g.is(a.target)||(d("."+f+"dropdown",c.$box).hide(),d("."+f+"active",c.$btnPane).removeClass(f+"active"),e.off("mousedown."+c.eventNamespace))}))},html:function(a){var b=this;return null!=a?(b.$ta.val(a),b.syncCode(!0),b.$c.trigger("tbwchange"),b):b.$ta.val()},syncTextarea:function(){var a=this;a.$ta.val(0<a.$ed.text().trim().length||0<a.$ed.find(a.o.tagsToKeep.join(",")).length?a.$ed.html():"")},syncCode:function(a){var b,c=this;!a&&c.$ed.is(":visible")?c.syncTextarea():(b=d("<div>").html(c.$ta.val()),b=d("<div>").append(b),d(c.o.tagsToRemove.join(","),b).remove(),c.$ed.html(b.contents().html())),c.o.autogrow&&(c.height=c.$ed.height(),c.height!==c.$ta.css("height")&&(c.$ta.css({height:c.height}),c.$c.trigger("tbwresize"))),c.o.autogrowOnEnter&&(c.$ed.height("auto"),(b=c.autogrowOnEnterWasFocused?c.$ed[0].scrollHeight:c.$ed.css("min-height"))!==c.$ta.css("height")&&(c.$ed.css({height:b}),c.$c.trigger("tbwresize")))},semanticCode:function(a,b,c){var e=this;e.saveRange(),e.syncCode(a);var f,g,h,a=!0;e.range&&e.range.collapsed&&(a=!1),e.o.semantic&&(e.semanticTag("b",e.o.semanticKeepAttributes),e.semanticTag("i",e.o.semanticKeepAttributes),e.semanticTag("s",e.o.semanticKeepAttributes),b&&(f=e.o.inlineElementsSelector,g=":not("+f+")",e.$ed.contents().filter(function(){return 3===this.nodeType&&0<this.nodeValue.trim().length}).wrap("<span data-tbw/>"),(h=function(a){var b;0!==a.length&&(a=(b=a.nextUntil(g).addBack().wrapAll("<p/>").parent()).nextAll(f).first(),b.next("br").remove(),h(a))})(e.$ed.children(f).first()),e.semanticTag("div",!0),d("[data-tbw]",e.$ed).contents().unwrap(),e.$ed.find("p:empty").remove()),!c&&a&&e.restoreRange(),e.syncTextarea())},semanticTag:function(a,b,c){var e,f=this,g=a;if(null!=this.o.semantic&&"object"==typeof this.o.semantic&&this.o.semantic.hasOwnProperty(a))e=this.o.semantic[a];else{if(!0!==this.o.semantic||!this.DEFAULT_SEMANTIC_MAP.hasOwnProperty(a))return;e=this.DEFAULT_SEMANTIC_MAP[a]}c&&(a=e,e=g),d(a,this.$ed).each(function(){var a=!1,c=d(this);if(0===c.contents().length)return!1;f.range.startContainer.parentNode&&f.range.startContainer.parentNode===this&&(a=!0);var g=d("<"+e+"/>");g.insertBefore(c),b&&d.each(c.prop("attributes"),function(){g.attr(this.name,this.value)}),g.html(c.html()),c.remove(),!0===a&&(f.range.selectNodeContents(g.get(0)),f.range.collapse(!1))})},createLink:function(){for(var a,b,c,e=this,f=e.doc.getSelection(),g=f.getRangeAt(0),h=f.focusNode,i=(new XMLSerializer).serializeToString(g.cloneContents())||g+"";["A","DIV"].indexOf(h.nodeName)<0;)h=h.parentNode;h&&"A"===h.nodeName&&(i=(g=d(h)).text(),c=g.attr("href"),e.o.minimalLinks||(a=g.attr("title"),b=g.attr("target")||e.o.defaultLinkTarget),(g=e.doc.createRange()).selectNode(h),f.removeAllRanges(),f.addRange(g)),e.saveRange(),i={url:{label:e.lang.linkUrl||"URL",required:!0,value:c},text:{label:e.lang.text,value:i}},e.o.minimalLinks||d.extend(i,{title:{label:e.lang.title,value:a},target:{label:e.lang.target,value:b}}),e.openModalInsert(e.lang.createLink,i,function(a){var b=e.prependUrlPrefix(a.url);return!!b.length&&(b=d(['<a href="',b,'">',a.text||a.url,"</a>"].join("")),a.title&&b.attr("title",a.title),(a.target||e.o.defaultLinkTarget)&&b.attr("target",a.target||e.o.defaultLinkTarget),e.range.deleteContents(),e.range.insertNode(b[0]),e.syncCode(),e.$c.trigger("tbwchange"),!0)})},prependUrlPrefix:function(a){return this.urlPrefix?/^([a-z][-+.a-z0-9]*:|\/|#)/i.test(a)?a:/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(a)?"mailto:"+a:this.urlPrefix+a:a},unlink:function(){var a,b=this.doc.getSelection(),c=b.focusNode;if(b.isCollapsed){for(;["A","DIV"].indexOf(c.nodeName)<0;)c=c.parentNode;c&&"A"===c.nodeName&&((a=this.doc.createRange()).selectNode(c),b.removeAllRanges(),b.addRange(a))}this.execCmd("unlink",void 0,void 0,!0)},insertImage:function(){var a=this;a.saveRange();var b={url:{label:"URL",required:!0},alt:{label:a.lang.description,value:a.getRangeText()}};a.o.imageWidthModalEdit&&(b.width={}),a.openModalInsert(a.lang.insertImage,b,function(b){a.execCmd("insertImage",b.url,!1,!0);var c=d('img[src="'+b.url+'"]:not([alt])',a.$box);return c.attr("alt",b.alt),a.o.imageWidthModalEdit&&c.attr({width:b.width}),a.syncCode(),a.$c.trigger("tbwchange"),!0})},fullscreen:function(){var a=this,c=a.o.prefix,e=c+"fullscreen",f=e+"-placeholder",g=a.$box.outerHeight();a.$box.toggleClass(e),(e=a.$box.hasClass(e))?a.$box.before(d("<div/>",{class:f}).css({height:g})):d("."+f).remove(),d("body").toggleClass(c+"body-fullscreen",e),d(b).trigger("scroll"),a.$c.trigger("tbw"+(e?"open":"close")+"fullscreen")},execCmd:function(a,c,e,f){var g=this;f=!!f||"","dropdown"!==a&&g.$ed.focus(),"strikethrough"===a&&g.o.semantic&&g.semanticTag("strike",g.o.semanticKeepAttributes,!0);try{g.doc.execCommand("styleWithCSS",!1,e||!1)}catch(a){}try{g[a+f](c)}catch(e){try{a(c)}catch(e){"insertHorizontalRule"===a?c=void 0:"formatBlock"===a&&g.isIE&&(c="<"+c+">"),g.doc.execCommand(a,!1,c),g.syncCode(),g.semanticCode(!1,!0);try{var h=b.getSelection().focusNode;d(b.getSelection().focusNode.parentNode).hasClass("trumbowyg-editor")||(h=b.getSelection().focusNode.parentNode);var i=g.o.tagClasses[c];i&&d(h).addClass(i)}catch(a){}}"dropdown"!==a&&(g.updateButtonPaneStatus(),g.$c.trigger("tbwchange"))}},openModal:function(a,c,g){var h=this,i=h.o.prefix;if(g=!1!==g,0<d("."+i+"modal-box",h.$box).length)return!1;h.o.autogrowOnEnter&&(h.autogrowOnEnterDontClose=!0),h.saveRange(),h.showOverlay(),h.$btnPane.addClass(i+"disable");var j=d("<div/>",{class:i+"modal "+i+"fixed-top"}).css({top:h.$box.offset().top+h.$btnPane.height(),zIndex:99999}).appendTo(d(h.doc.body));return h.$overlay.one("click",function(){return j.trigger(f),!1}),c=g?d("<form/>",{action:"",html:c}).on("submit",function(){return j.trigger(e),!1}).on("reset",function(){return j.trigger(f),!1}).on("submit reset",function(){h.o.autogrowOnEnter&&(h.autogrowOnEnterDontClose=!1)}):c,c=d("<div/>",{class:i+"modal-box",html:c}).css({top:"-"+h.$btnPane.outerHeight(),opacity:0,paddingBottom:g?null:"5%"}).appendTo(j).animate({top:0,opacity:1},100),a&&d("<span/>",{text:a,class:i+"modal-title"}).prependTo(c),g&&(d("input:first",c).focus(),h.buildModalBtn("submit",c),h.buildModalBtn("reset",c),j.height(c.outerHeight()+10)),d(b).trigger("scroll"),h.$c.trigger("tbwmodalopen"),j},buildModalBtn:function(a,b){var c=this.o.prefix;return d("<button/>",{class:c+"modal-button "+c+"modal-"+a,type:a,text:this.lang[a]||a}).appendTo(d("form",b))},closeModal:function(){var a=this,b=a.o.prefix;a.$btnPane.removeClass(b+"disable"),a.$overlay.off();var c=d("."+b+"modal-box",d(a.doc.body));c.animate({top:"-"+c.height()},100,function(){c.parent().remove(),a.hideOverlay(),a.$c.trigger("tbwmodalclose")}),a.restoreRange()},openModalInsert:function(a,b,c){var g=this,h=g.o.prefix,i=g.lang,j="";return d.each(b,function(a,b){var c=b.label||a,d=b.name||a,e=b.attributes||{},a=Object.keys(e).map(function(a){return a+'="'+e[a]+'"'}).join(" ");j+='<label><input type="'+(b.type||"text")+'" name="'+d+'"'+("checkbox"===b.type&&b.value?' checked="checked"':' value="'+(b.value||"").replace(/"/g,"&quot;"))+'"'+a+'><span class="'+h+'input-infos"><span>'+(i[c]||c)+"</span></span></label>"}),g.openModal(a,j).on(e,function(){var a=d("form",d(this)),f=!0,h={};d.each(b,function(b,c){var e=c.name||b,i=d('input[name="'+e+'"]',a);switch(i.attr("type").toLowerCase()){case"checkbox":h[e]=i.is(":checked");break;case"radio":h[e]=i.filter(":checked").val();break;default:h[e]=d.trim(i.val())}c.required&&""===h[e]?(f=!1,g.addErrorOnModalField(i,g.lang.required)):c.pattern&&!c.pattern.test(h[e])&&(f=!1,g.addErrorOnModalField(i,c.patternError))}),f&&(g.restoreRange(),c(h,b)&&(g.syncCode(),g.$c.trigger("tbwchange"),g.closeModal(),d(this).off(e)))}).one(f,function(){d(this).off(e),g.closeModal()})},addErrorOnModalField:function(a,b){var c=this.o.prefix,e=c+"msg-error",f=a.parent();a.on("change keyup",function(){f.removeClass(c+"input-error"),setTimeout(function(){f.find("."+e).remove()},150)}),f.addClass(c+"input-error").find("input+span").append(d("<span/>",{class:e,text:b}))},getDefaultImgDblClickHandler:function(){var a=this;return function(){var b=d(this),c=b.attr("src"),e="(Base64)";return 0===c.indexOf("data:image")&&(c=e),c={url:{label:"URL",value:c,required:!0},alt:{label:a.lang.description,value:b.attr("alt")}},a.o.imageWidthModalEdit&&(c.width={value:b.attr("width")?b.attr("width"):""}),a.openModalInsert(a.lang.insertImage,c,function(c){return c.url!==e&&b.attr({src:c.url}),b.attr({alt:c.alt}),a.o.imageWidthModalEdit&&(0<parseInt(c.width)?b.attr({width:c.width}):b.removeAttr("width")),!0}),!1}},saveRange:function(){var a,b=this,c=b.doc.getSelection();b.range=null,c&&c.rangeCount&&(a=b.range=c.getRangeAt(0),(c=b.doc.createRange()).selectNodeContents(b.$ed[0]),c.setEnd(a.startContainer,a.startOffset),c=(c+"").length,b.metaRange={start:c,end:c+(a+"").length})},restoreRange:function(){var a=this,b=a.metaRange,c=a.range,d=a.doc.getSelection();if(c){if(b&&b.start!==b.end)for(var e,f=0,g=[a.$ed[0]],h=!1,i=!1,j=a.doc.createRange();!i&&(e=g.pop());)if(3===e.nodeType){var k=f+e.length;!h&&b.start>=f&&b.start<=k&&(j.setStart(e,b.start-f),h=!0),h&&b.end>=f&&b.end<=k&&(j.setEnd(e,b.end-f),i=!0),f=k}else for(var l=e.childNodes,m=l.length;0<m;)--m,g.push(l[m]);try{d.removeAllRanges()}catch(a){}d.addRange(j||c)}},getRangeText:function(){return this.range+""},clearButtonPaneStatus:function(){var a=this.o.prefix,b=a+"active-button "+a+"active",c=a+"original-icon";d("."+a+"active-button",this.$btnPane).removeClass(b),d("."+c,this.$btnPane).each(function(){d(this).find("svg use").attr("xlink:href",d(this).data(c))})},updateButtonPaneStatus:function(){var a=this,b=a.o.prefix,c=b+"active-button "+b+"active",e=b+"original-icon",f=a.getTagsRecursive(a.doc.getSelection().focusNode);a.clearButtonPaneStatus(),d.each(f,function(f,g){var h=a.tagToButton[g.toLowerCase()],i=d("."+b+h+"-button",a.$btnPane);if(0<i.length)i.addClass(c);else try{var j=(i=d("."+b+"dropdown ."+b+h+"-dropdown-button",a.$box)).find("svg use"),k=i.parent().data(b+"dropdown"),l=d("."+b+k+"-button",a.$box),k=l.find("svg use");l.addClass(c),a.o.changeActiveDropdownIcon&&0<j.length&&(l.addClass(e).data(e,k.attr("xlink:href")),k.attr("xlink:href",j.attr("xlink:href")))}catch(a){}})},getTagsRecursive:function(a,b){var c=this;if(b=b||(a&&a.tagName?[a.tagName]:[]),!a||!a.parentNode)return b;var e=(a=a.parentNode).tagName;return"DIV"===e?b:("P"===e&&""!==a.style.textAlign&&b.push(a.style.textAlign),d.each(c.tagHandlers,function(d,e){b=b.concat(e(a,c))}),b.push(e),c.getTagsRecursive(a,b).filter(function(a){return null!=a}))},initPlugins:function(){var a=this;a.loadedPlugins=[],d.each(d.trumbowyg.plugins,function(b,c){c.shouldInit&&!c.shouldInit(a)||(c.init(a),c.tagHandler&&a.tagHandlers.push(c.tagHandler),a.loadedPlugins.push(c))})},destroyPlugins:function(){var a=this;d.each(this.loadedPlugins,function(b,c){c.destroy&&c.destroy(a)})}}}(navigator,window,document,jQuery);